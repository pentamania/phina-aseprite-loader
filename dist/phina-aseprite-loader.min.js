/*!
 * 
 * phina-aseprite-loader v0.1.0
 * MIT Licensed
 * Copyright (C) pentamania
 * 
 */
!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("phina.js"));else if("function"==typeof define&&define.amd)define(["phina.js"],e);else{var i="object"==typeof exports?e(require("phina.js")):e(t.phina);for(var n in i)("object"==typeof exports?exports:t)[n]=i[n]}}(this,function(t){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(e,i){e.exports=t},function(t,e,i){"use strict";i.r(e);var n=i(0),r=i.n(n);r.a.define("phina.asset.AsepriteSpriteSheet",{superClass:r.a.asset.Asset,init:function(){this.superInit(),this.pivot,this._maxFrameCount=1},setup:function(t){this._setupFrame(t.frames),this._setupAnim(t.meta.frameTags);var e=t.meta.slices.find(function(t){return"Pivot"===t.name});return e&&(this.pivot=e.keys[0].pivot),this},_load:function(t){var e=this;if("string"==typeof this.src){var i=new XMLHttpRequest;i.open("GET",this.src),i.onreadystatechange=function(){if(4===i.readyState&&-1!==[200,201,0].indexOf(i.status)){var n=i.responseText,r=JSON.parse(n);e.setup(r),t(e)}},i.send(null)}else this.setup(this.src),t(e)},_setupFrame:function(t){var e=this.frames=[];t.forIn(function(t,i){var n=i.frame;e.push({x:n.x,y:n.y,width:n.w,height:n.h,duration:i.duration})}),this._maxFrameCount=e.length},_setupAnim:function(t){this.animations={},this.animations.default={frames:[].range(0,this._maxFrameCount),next:"default",frequency:1},t.forEach(function(t){this.animations[t.name]={frames:[].range(t.from,t.to+1)}}.bind(this))},getFrame:function(t){return this.frames[t]},getAnimation:function(t){return t=void 0!==t?t:"default",this.animations[t]}}),r.a.asset.AssetLoader.register("aseprite",function(t,e){return r.a.asset.AsepriteSpriteSheet().load(e)}),r.a.accessory.FrameAnimation.prototype.init=function(t){this.superInit(),this.ss=r.a.asset.AssetManager.get("spritesheet",t)||r.a.asset.AssetManager.get("aseprite",t),this.ss?(this.paused=!0,this.finished=!1,this.fit=!0,this.currentAnimationFrame=null,this._elapsedTime=0):console.error("[phina.js] spritesheet '{0}' doesn't exist.".format(t))},r.a.accessory.FrameAnimation.prototype.update=function(t){if(!this.paused&&this.currentAnimation){if(this.finished)return this.finished=!1,void(this.currentFrameIndex=0);if(++this.frame,null!=this.currentAnimation.frequency&&this.frame%this.currentAnimation.frequency==0)return++this.currentFrameIndex,void this._updateFrame();this._elapsedTime+=t.deltaTime,this.currentAnimationFrame&&null!=this.currentAnimationFrame.duration&&this.currentAnimationFrame.duration<=this._elapsedTime&&(++this.currentFrameIndex,this._updateFrame(),this._elapsedTime=0)}},r.a.accessory.FrameAnimation.prototype._updateFrame=function(){var t=this.currentAnimation;if(t&&this.currentFrameIndex>=t.frames.length)return t.next?void this.gotoAndPlay(t.next):(this.paused=!0,this.finished=!0,void this.flare("ended"));var e=t.frames[this.currentFrameIndex],i=this.ss.getFrame(e);this.target.srcRect.set(i.x,i.y,i.width,i.height),this.currentAnimationFrame=i,this.fit&&(this.target.width=i.width,this.target.height=i.height)},r.a.accessory.FrameAnimation.prototype.setNext=function(t,e){return(t=this.ss.getAnimation(t)).next=e,this},e.default=r.a}])});