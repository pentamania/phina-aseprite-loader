/*!
 * 
 * phina-aseprite-loader v0.2.0
 * MIT Licensed
 * Copyright (C) pentamania
 * 
 */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("phina.js"));else if("function"==typeof define&&define.amd)define(["phina.js"],t);else{var i="object"==typeof exports?t(require("phina.js")):t(e.phina);for(var n in i)("object"==typeof exports?exports:e)[n]=i[n]}}(this,function(e){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=2)}([function(t,i){t.exports=e},function(e,t){var i=function(){var e=Array.prototype.slice.call(arguments),t=[];return e.forEach(function(i,n){var r=e[n+1];if(null!=r&&i!==r)if(i<r)for(n=i;n<r;n++)t.push(n);else for(n=i;n>r;n--)t.push(n)}),t};e.exports={createFramesByTagProperty:function(e){return"pingpong"===e.direction?i(e.from,e.to,e.from-1):"reverse"===e.direction?i(e.to,e.from-1):i(e.from,e.to+1)}}},function(e,t,i){"use strict";i.r(t);var n=i(0),r=i.n(n),s=i(1);r.a.define("phina.asset.AsepriteSpriteSheet",{superClass:r.a.asset.Asset,init:function(){this.superInit(),this._maxFrameCount=1},setup:function(e){return this._setupFrame(e.frames),this._setupAnim(e.meta.frameTags),this.slices={},e.meta.slices&&e.meta.slices.forEach(function(e){this.slices[e.name]=e}.bind(this)),this},getSliceData:function(e,t){return t=t||0,this.slices[e]?this.slices[e].keys[t]:(console.warn("[phina-aseprite-loader]: Slice name '"+e+"' doesn't exist."),null)},_load:function(e){var t=this;if("string"==typeof this.src){var i=new XMLHttpRequest;i.open("GET",this.src),i.onreadystatechange=function(){if(4===i.readyState&&-1!==[200,201,0].indexOf(i.status)){var n=i.responseText,r=JSON.parse(n);t.setup(r),e(t)}},i.send(null)}else this.setup(this.src),e(t)},_setupFrame:function(e){var t=this.frames=[];e.forIn(function(e,i){var n=i.frame;t.push({x:n.x,y:n.y,width:n.w,height:n.h,duration:i.duration})}),this._maxFrameCount=t.length},_setupAnim:function(e){this.animations={},this.animations.default={frames:[].range(0,this._maxFrameCount),next:"default",frequency:1},e.forEach(function(e){this.animations[e.name]={frames:Object(s.createFramesByTagProperty)(e)}}.bind(this))},getFrame:function(e){return this.frames[e]},getAnimation:function(e){return e=void 0!==e?e:"default",this.animations[e]},_accessor:{pivot:{get:function(){return this.slices.pivot?this.slices.pivot.keys[0].pivot:null}}}}),r.a.asset.AssetLoader.register("aseprite",function(e,t){return r.a.asset.AsepriteSpriteSheet().load(t)}),r.a.accessory.FrameAnimation.prototype.init=function(e){this.superInit(),this.ss=r.a.asset.AssetManager.get("spritesheet",e)||r.a.asset.AssetManager.get("aseprite",e),this.ss?(this.paused=!0,this.finished=!1,this.fit=!0,this.currentAnimationFrame=null,this._elapsedTime=0):console.error("[phina.js] spritesheet '{0}' doesn't exist.".format(e))},r.a.accessory.FrameAnimation.prototype.update=function(e){if(!this.paused&&this.currentAnimation){if(this.finished)return this.finished=!1,void(this.currentFrameIndex=0);if(++this.frame,null!=this.currentAnimation.frequency&&this.frame%this.currentAnimation.frequency==0)return++this.currentFrameIndex,void this._updateFrame();this._elapsedTime+=e.deltaTime,this.currentAnimationFrame&&null!=this.currentAnimationFrame.duration&&this.currentAnimationFrame.duration<=this._elapsedTime&&(++this.currentFrameIndex,this._updateFrame(),this._elapsedTime=0)}},r.a.accessory.FrameAnimation.prototype._updateFrame=function(){var e=this.currentAnimation;if(e&&this.currentFrameIndex>=e.frames.length)return e.next?void this.gotoAndPlay(e.next):(this.paused=!0,this.finished=!0,void this.flare("ended"));var t=e.frames[this.currentFrameIndex],i=this.ss.getFrame(t);this.target.srcRect.set(i.x,i.y,i.width,i.height),this.currentAnimationFrame=i,this.fit&&(this.target.width=i.width,this.target.height=i.height)},r.a.accessory.FrameAnimation.prototype.setNext=function(e,t){return(e=this.ss.getAnimation(e)).next=t,this},t.default=r.a}])});